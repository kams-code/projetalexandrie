
<div class="modal" id="addcatModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h4 class="modal-title">Ajouter une nouvelle catégorie</h4>
      </div>
      <div class="modal-body" >
		<div class="row">
        <form id="formcat" class="col-lg-12" >
			
			<div id="alertcat" class="alert alert-warning alert-dismissable col-lg-12" style="display: none">
				<button type="button" class="close" data-dismiss="alert">×</button>
				  catégorie ajoutée avec succès
			</div>
			
			{{ form_errors(form_cat) }}
	
			<div class="row">
			<div class="col-md-12">
			
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_cat.designation, "Designation")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_cat.designation) }}
					  {{ form_widget(form_cat.designation, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
				
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_cat.parent, "Catégorie parente")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_cat.parent) }}
					  {{ form_widget(form_cat.parent, {'attr':{'class':'form-control select-one'}}) }}
					  </div>
					  
					</div>
				</div>
				
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_cat.image, "Image")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_cat.image) }}
					  {{ form_widget(form_cat.image, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
				
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_cat.description, "Description ")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_cat.description) }}
					  {{ form_widget(form_cat.description, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
			</div>
			</div>
			<br/>
			
			{{ form_rest(form_cat) }}
			
			<div class="form-group">
				<button id="sendcatButton" class="pull-left btn btn-default">Enregistrer</button> <span id="fa-refresh-cat" style="visibility:hidden"> <i  class="fa fa-refresh fa-spin fa-lg fa-fw"></i> Enregistrement en cours...</span>
			</div>
			
		  
		</form>
		</div>
		
      </div>
	  <div class="modal-footer">
		<button  class="btn btn-info" data-dismiss="modal">Fermer</button>
	  </div>
    </div>
  </div>
</div>


<div class="modal" id="addkeyModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h4 class="modal-title">Ajouter un nouveau mot clé</h4>
      </div>
      <div class="modal-body" >
		<div class="row">
        <form id="formkeyword" class="col-lg-12" >
			
			<div id="alertkey" class="alert alert-warning alert-dismissable col-lg-12" style="display: none">
				<button type="button" class="close" data-dismiss="alert">×</button>
				  mot clé ajouté avec succès
			</div>
			
			{#{{ form_widget(form_keyword) }}#}
	
			{# Les erreurs générales du formulaire. #}
			
			{{ form_errors(form_keyword) }}
			
			<div class="row">
			<div class="col-md-8">
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_keyword.designation, "Designation")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_keyword.designation) }}
					  {{ form_widget(form_keyword.designation, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
				
				
			</div>
			</div>
			
			<br/>
			
		   {{ form_rest(form_keyword) }}
			
		  <div class="form-group">
			<button id="sendkeyButton" class="pull-left btn btn-default">Enregistrer</button>
		  </div>
		  <span id="fa-refresh-key" style="visibility:hidden"> <i  class="fa fa-refresh fa-spin fa-lg fa-fw"></i> Enregistrement en cours...</span>
		  
		</form>
		</div>
		
      </div>
	  <div class="modal-footer">
		<button  class="btn btn-info" data-dismiss="modal">Fermer</button>
	  </div>
    </div>
  </div>
</div>


<div class="modal" id="addNatureModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h4 class="modal-title">Ajouter une nouvelle Nature</h4>
      </div>
      <div class="modal-body" >
		<div class="row">
        <form id="formNature" class="col-lg-12" >
			
			<div id="alertNature" class="alert alert-warning alert-dismissable col-lg-12" style="display: none">
				<button type="button" class="close" data-dismiss="alert">×</button>
				  Nature ajouté avec succès
			</div>
			
			{#{{ form_widget(form_nature) }}#}
	
			{# Les erreurs générales du formulaire. #}
			
			{{ form_errors(form_nature) }}
			
			<div class="row">
			<div class="col-md-8">
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_nature.designation, "Designation")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_nature.designation) }}
					  {{ form_widget(form_nature.designation, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
				
				<div class="row">
					<div class="form-group">
					
					  <div class="col-md-12">
					  {{ form_label(form_nature.description, "Description")}} : 
					  </div>
					  
					  <div class="col-md-12">
					  {{ form_errors(form_nature.description) }}
					  {{ form_widget(form_nature.description, {'attr':{'class':'form-control'}}) }}
					  </div>
					  
					</div>
				</div>
			</div>
			</div>
			
			<br/>
			
		   {{ form_rest(form_nature) }}
			
		  <div class="form-group">
			<button id="sendNatureButton" class="pull-left btn btn-default">Enregistrer</button>
		  </div>
		  <span id="fa-refresh-nature" style="visibility:hidden"> <i  class="fa fa-refresh fa-spin fa-lg fa-fw"></i> Enregistrement en cours...</span>
		  
		</form>
		</div>
		
      </div>
	  <div class="modal-footer">
		<button  class="btn btn-info" data-dismiss="modal">Fermer</button>
	  </div>
    </div>
  </div>
</div>


<script>

    $(function() {
		
        $('.addcatlink').on('click', function (event) {
			 $('#addcatModal').modal('show');
		});
		
		$('.addkeylink').on('click', function (event) {
			
			 $('#addkeyModal').modal('show');
		});
		
		$('.addNatureLink').on('click', function (event) {
			
			 $('#addNatureModal').modal('show');
		});
		
		//detection du changement sur le formulaire
		$('#formcat').on('input', function (event) {
		
			$("#alertcat").hide("slow");
		
		});
		
		//detection du changement sur le formulaire
		$('#formkeyword').on('input', function (event) {
		
			$("#alertkey").hide("slow");
		
		});
		
		//detection du changement sur le formulaire
		$('#formNature').on('input', function (event) {
		
			$("#alertNature").hide("slow");
		
		});
		
		$('#formcat').on('submit', function (event) {
			
			// On empêche le navigateur de soumettre le formulaire
			event.preventDefault();
			$('#fa-refresh-cat').css('visibility','visible');
			$('#sendcatButton').css('display','none');
			
			var $form = $(this);
			var formdata = (window.FormData) ? new FormData($form[0]) : null;
			var data = (formdata !== null) ? formdata : $form.serialize();
			
			$.ajax({
				url: '{{ path('erico_backend_addcat_page')}}?type=ajax',
				type: 'POST',
				contentType: false, // obligatoire pour de l'upload
				processData: false, // obligatoire pour de l'upload
				dataType: 'json', // selon le retour attendu
				timeout: 60000, //une minute pour executer sinon error
				data: data,
				success: function (response) {
					$("#alertcat").show("slow");
					//alert(" la catégorie " + response.designation + " a été crée avec succès ");
					$('.selectcat').prepend('<option value="' + response.id +'" selected>' +  response.chemin + '</option>');
					$('.selectcat').multiselect('rebuild');
					$('#formcat')[0].reset();	
					$('#fa-refresh-cat').css('visibility','hidden');
					$('#sendcatButton').css('display','block');
				},
				error: function(){
					
					alert('la requete n a pas abouti');
					$('#sendcatButton').css('display','block');
					$('#fa-refresh-cat').css('visibility','hidden');
				}
			});
		
		});
		
		$('#formkeyword').on('submit', function (event) {
			
			// On empêche le navigateur de soumettre le formulaire
			event.preventDefault();
			$('#fa-refresh-key').css('visibility','visible');
			$('#sendkeyButton').css('display','none');
			
			var $form = $(this);
			var formdata = (window.FormData) ? new FormData($form[0]) : null;
			var data = (formdata !== null) ? formdata : $form.serialize();
			
			$.ajax({
				url: '{{ path('erico_backend_addkeyword_page')}}?type=ajax',
				type: 'POST',
				contentType: false, // obligatoire pour de l'upload
				processData: false, // obligatoire pour de l'upload
				dataType: 'json', // selon le retour attendu
				timeout: 60000, //une minute pour executer sinon error
				data: data,
				success: function (response) {
					$("#alertkey").show("slow");
					
					//alert(" la catégorie " + response.designation + " a été crée avec succès ");
					$(".selectkey").prepend('<option value="' + response.id +'" selected>' +  response.designation + '</option>');
					$('.selectkey').multiselect('rebuild');
					$('#formkeyword')[0].reset();	
					$('#fa-refresh-key').css('visibility','hidden');
					$('#sendkeyButton').css('display','block');
				},
				error: function(){
					
					alert('la requete n a pas abouti');
					$('#sendkeyButton').css('display','block');
					$('#fa-refresh-key').css('visibility','hidden');
				}
			});
		
		});
		
		
		$('#formNature').on('submit', function (event) {
			
			// On empêche le navigateur de soumettre le formulaire
			event.preventDefault();
			$('#fa-refresh-nature').css('visibility','visible');
			$('#sendNatureButton').css('display','none');
			
			var $form = $(this);
			var formdata = (window.FormData) ? new FormData($form[0]) : null;
			var data = (formdata !== null) ? formdata : $form.serialize();
			
			//$(".selectnature").prepend('<option value="0" selected> ordonnance </option>');
			
			$.ajax({
				url: '{{ path('erico_backend_addNature_page')}}?type=ajax',
				type: 'POST',
				contentType: false, // obligatoire pour de l'upload
				processData: false, // obligatoire pour de l'upload
				dataType: 'json', // selon le retour attendu
				timeout: 60000, //une minute pour executer sinon error
				data: data,
				success: function (response) {
				
					$("#alertNature").show("slow");
					
					//alert(" la catégorie " + response.designation + " a été crée avec succès ");
					$(".selectnature").prepend('<option value="' + response.id +'" selected>' +  response.designation + '</option>');
					//$('.selectkey').multiselect('rebuild');
					$('#formNature')[0].reset();	
					$('#fa-refresh-nature').css('visibility','hidden');
					$('#sendNatureButton').css('display','block');
				},
				error: function(){
					
					alert('la requete n a pas abouti');
					$('#sendNatureButton').css('display','block');
					$('#fa-refresh-nature').css('visibility','hidden');
				}
			});
		
		});
		
		
		
		
    });
	
	

</script>